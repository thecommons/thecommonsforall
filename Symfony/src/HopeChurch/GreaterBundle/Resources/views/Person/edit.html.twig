{% extends 'HopeChurchGreaterBundle:Default:base.html.twig' %}

{% block styleblock %}
{{ parent() }}
{% stylesheets
'bundles/hopechurchgreater/libs/bootstrap-formhelpers/css/bootstrap-formhelpers.css'
'bundles/hopechurchgreater/libs/select2/select2.css'
'bundles/hopechurchgreater/libs/select2/select2-bootstrap.css'
filter='cssrewrite' %}
<link rel="stylesheet" href="{{ asset_url }}" />
{% endstylesheets %}
{% endblock %}

{% block head_js %}
{{ parent() }}
var mentorsByDStageUrl = "{{path('hope_church_backstage_get_mentor_by_dstage') }}";
{% endblock %}

{% block jsblock %}
{{ parent() }}

{% javascripts
'bundles/hopechurchgreater/libs/select2/select2.min.js'

'bundles/hopechurchgreater/libs/bootstrap-formhelpers/js/bootstrap-formhelpers-phone.js'
'bundles/hopechurchgreater/libs/bootstrap-formhelpers/js/bootstrap-formhelpers-phone.format.js'

'bundles/hopechurchgreater/libs/bootstrap-formhelpers/js/bootstrap-formhelpers-countries.js'
'bundles/hopechurchgreater/libs/bootstrap-formhelpers/js/bootstrap-formhelpers-countries.en_US.js'
'bundles/hopechurchgreater/libs/bootstrap-formhelpers/js/bootstrap-formhelpers-states.js'
'bundles/hopechurchgreater/libs/bootstrap-formhelpers/js/bootstrap-formhelpers-states.en_US.js'
'bundles/hopechurchgreater/libs/d3/js/d3.v3.min.js'
'@HopeChurchGreaterBundle/Resources/public/js/person/edit.js'
%}
<script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}

{% endblock %}

{# style the elements in the form #}
{% form_theme edit_form _self %}
{% block form_row %}
    <div class="form-group">
        {{
        form_label(form, null, {'label_attr': {'class': 'col-md-2 control-label'}})
        }}
      <div class="col-md-10">
        {{ form_widget(form, {'attr': {'placeholder': placeholder | default(label), 'class': 'form-control'}}) }}
        {{ form_errors(form) }}
        {% if help_blocks is defined %}
        {% for help in help_blocks %}
        <p class="help-block">{{ help }}</p>
        {% endfor %}
        {% endif %}
      </div>
    </div>
{% endblock form_row %}

{% block choice_widget_expanded %}
{% spaceless %}
    <div {% if id is defined %} id="{{ id }}" {% endif %}>
    {% for child in form %}
        {{ form_widget(child) }}
    {% endfor %}
    </div>
{% endspaceless %}
{% endblock choice_widget_expanded %}

{% block checkbox_widget %}
{% spaceless %}
    <div class="checkbox">
      <input type="checkbox" {{ block('widget_attributes') }}{% if value is
      defined %} value="{{ value }}"{% endif %}{% if checked %}
      checked="checked"{% endif %} />
    </div>
{% endspaceless %}
{% endblock checkbox_widget %}

{# form_errors.html.twig #}
{% block form_errors %}
    {% spaceless %}
    {% if errors|length > 0 %}
    {% for error in errors %}
    <span class="help-block"><p class="text-danger">
    {{
    error.messagePluralization is null
    ? error.messageTemplate|trans(error.messageParameters, 'validators')
    : error.messageTemplate|transchoice(error.messagePluralization, error.messageParameters, 'validators')
    }}
    </p></span>
    {% endfor %}
    {% endif %}
    {% endspaceless %}
{% endblock form_errors %}

{% block body -%}
<div class="page-header">
  <div class="pull-left">
    <h1>Edit Person</h1>
  </div>
  <div class="pull-right btn-header-sm">
    <div class="btn-group">
      <a class="btn btn-primary btn-sm" href="{{ path('person_delete', {'id': delete_form.vars.id}) }}">
	<span class="glyphicon glyphicon-trash"></span>
      </a>
      <a class="btn btn-primary btn-sm" href="{{ path('person_new') }}">
	<span class="glyphicon glyphicon-plus"></span>
      </a>
    </div>
  </div>
  <div class="clearfix"></div>
</div>

{% for flashMessage in app.session.flashbag.get('success') %}
<div class="alert alert-success">
  {{ flashMessage }}
</div>
{% endfor %}

{% for flashMessage in app.session.flashbag.get('error') %}
<div class="alert alert-danger">
  {{ flashMessage }}
</div>
{% endfor %}

<form class="form-horizontal"
      action="{{ path('person_edit', {'id': edit_form.vars.id}) }}"
      method="post" {{ form_enctype(edit_form) }}
      id="form-person"
      >
  <fieldset>
    {# NAME #}
    <legend>Basic Info</legend>
    {{
    form_row(edit_form.nameFirst,
      {'help_blocks':
        [
          'Even if you know nothing about this person, write the best description you can in here.',
           'Once you find out who they are this can be updated.'
        ]
      }
    )
    }}

    {{ form_row(edit_form.nameLast) }}

    {{ form_row(edit_form.age) }}

    {{
    form_row(edit_form.referrer,
      {'help_blocks':
        [
          'How did this person hear about us?',
	  'If "Other", then please use the Notes field below to provide further info.'
        ]
      }
    )
    }}

    <div class="form-group">
        {{
      form_label(edit_form.notes, null, {'label_attr': {'class': 'col-md-2 control-label'}})
        }}
      <div class="col-md-10">
        <textarea class="input-xxlarge form-control" rows="4"
                  id="{{ edit_form.notes.vars.id }}"
                  name="{{ edit_form.notes.vars.full_name }}"
                  placeholder="Anything else?">{{ edit_form.notes.vars.value }}</textarea>
      </div>
    </div>
  </fieldset>

    <fieldset>
      <legend>Further Info</legend>

      {{ form_row(edit_form.status,
        {'help_blocks':
          [
            'Only change status if adding an inactive person.',
            'For example, family that may visit again but not permanently attend.',
          ]
        }
        )
      }}

      {# TODO only show this if age is adult? #}
      {{ form_row(edit_form.roles,
        {'help_blocks':
          [
            'What position(s) does this person hold?',
          ]
        }
        )
      }}
    </fieldset>

    <fieldset>
      <legend>Discipleship Pathway</legend>
      {{
        form_row(edit_form.discipleshipStage,
          {'help_blocks':
            [
              'What Discipleship Stage is this person currently in?',
              'If they have just started attending, then leave set to "Sunday Gathering."'
            ]
          }
        )
      }}

      {{
      form_row(edit_form.mentor, {'help_blocks':
      ['Who is responsible for mentoring this person toward their next Discipleship Stage?']
      })
      }}

      {# BAPTIZED #}
      <div class="form-group">
	{{
	form_label(edit_form.baptized, null, {'label_attr': {'class': 'col-md-2 control-label'}})
	}}
	<div class="col-md-10">
          <div class="checkbox">
            <input type="checkbox"
                   id="{{ edit_form.baptized.vars.id }}"
                   name="{{ edit_form.baptized.vars.full_name }}"
		   {% if edit_form.baptized.vars.checked %} checked="checked"{%
                   endif %}
                   >
            <p class="help-block">Has this person been baptized?</p>
          </div>
	</div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Contact Details</legend>
      {# EMAIL #}
      {{ form_row(edit_form.email) }}

      {# PHONE #}
      <div class="form-group">
        {{
        form_label(edit_form.phoneCell, null, {'label_attr': {'class': 'col-md-2 control-label'}})
        }}
        <div class="col-md-10">
          <input type="text"
                 id="{{ edit_form.phoneCell.vars.id }}"
                 name="{{ edit_form.phoneCell.vars.full_name }}"
                 placeholder="{{ edit_form.phoneCell.vars.label }}"
                 class="bfh-phone form-control" data-country="US"
		 {% if edit_form.phoneCell.vars.value %} data-number="{{
                 edit_form.phoneCell.vars.value }}"{% endif %}>
        </div>
      </div>

      <div class="form-group">
        {{
        form_label(edit_form.phoneHome, null, {'label_attr': {'class': 'col-md-2 control-label'}})
        }}
        <div class="col-md-10">
          <input type="text"
                 id="{{ edit_form.phoneHome.vars.id }}"
                 name="{{ edit_form.phoneHome.vars.full_name }}"
                 placeholder="{{ edit_form.phoneHome.vars.label }}"
                 class="form-control bfh-phone" data-country="US"
		 {% if edit_form.phoneHome.vars.value %} data-number="{{
                 edit_form.phoneHome.vars.value }}"{% endif %}>
        </div>
      </div>

      {# FACEBOOK #}
        {{
      form_label(edit_form.facebook, null, {'label_attr': {'class': 'col-md-2 control-label'}})
        }}
      <div class="col-md-10">
        <div class="checkbox">
          <input type="checkbox"
                 id="{{ edit_form.facebook.vars.id }}"
                 name="{{ edit_form.facebook.vars.full_name }}"
		 {% if edit_form.facebook.vars.checked %} checked="checked"{%
                 endif %}
                 >
          <p class="help-block">Does at least one leader have this person added
          as a friend on FB?</p>
        </div>
      </div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Snail-Mail</legend>
      {# ADDRESS #}
      {{ form_row(edit_form.addrFirst, {'placeholder': "Address #1"}) }}
      {{ form_row(edit_form.addrSecond, {'placeholder': "Address #2"}) }}
      {{ form_row(edit_form.addrCity) }}
      {{ form_row(edit_form.addrZip) }}
      <div class="form-group">
        {{
        form_label(edit_form.addrCountry, null, {'label_attr': {'class': 'col-md-2 control-label'}})
        }}
        <div class="col-md-10">
          <select class="bfh-countries form-control"
                  data-country="US"
                  id="{{ edit_form.addrCountry.vars.id }}"
                  name="{{ edit_form.addrCountry.vars.full_name }}"
                  ></select>
        </div>
      </div>
      <div class="form-group">
        {{
        form_label(edit_form.addrState, null, {'label_attr': {'class': 'col-md-2 control-label'}})
        }}
        <div class="col-md-10">
          <select class="bfh-states form-control"
                  data-country="{{ edit_form.addrCountry.vars.id }}"
                  data-state="CA"
                  id="{{ edit_form.addrState.vars.id }}"
                  name="{{ edit_form.addrState.vars.full_name }}"
                  ></select>
        </div>
      </div>
    </fieldset>

    {# RELATIONSHIPS #}
    <fieldset>
      <legend>Relationships</legend>

      {# TODO - ADD THESE #}
      <div class="form-group">
          <label for="inputFamily" class="col-md-2 control-label">Family</label>
          <div class="col-md-10">
            <input class="form-control" type="text" id="inputSmallgroup"
                   placeholder="Coming soon..." disabled/>
          </div>
      </div>

      <div class="form-group">
        <label for="inputSmallgroup" class="col-md-2 control-label">Community Group</label>
        <div class="col-md-10">
          <input class="form-control" type="text" id="inputSmallgroup"
                 placeholder="Coming soon..." disabled/>
        </div>
      </div>
    </fieldset>

  <div class="form-actions">
    <button type="submit" class="btn btn-primary">Update Person</button>
  </div>
  {{ form_row(edit_form._token) }}

</form>

<!--
        <ul class="record_actions">
    <li>
        <a href="{{ path('person') }}">
            Back to the list
        </a>
    </li>
    <li>{{ form(delete_form) }}</li>
</ul>
-->
{% endblock %}
